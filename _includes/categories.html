<script type="text/javascript">
(function() {
	// Dictionary for external links
	var exts = [
	{% for post in site.posts %}
		{% for ext in post.external %}
			["{{ ext[0] }}", "{{ ext[1] }}"],
		{% endfor %}
	{% endfor %}
	]

	window.externals = {}

	for (var i in exts) {
		var ext = exts[i]
		if (externals[ext[0]])
			externals[ext[0]].push(ext[1])
		else
			externals[ext[0]] = [ext[1]]
	}

	// Dictionary for specs

	var specs  = [
	{% for post in site.posts %}
		{% for spec in post.specs %}
			{% for s in spec[1] %}
				["{{ spec[0] }}","{{ s }}" , "{{ post.url }}", "{{ post.title }}"],
			{% endfor %}
		{% endfor %}
	{% endfor %}
	]

	window.specifications = {}

	for (var i in specs) {
		var spec = specs[i]
		var specObj = {}
		specObj[spec[1]] = {url: spec[2], title: spec[3]}

		if (specifications[spec[0]]) {
			if (specifications[spec[0]][spec[1]])
				specifications[spec[0]][spec[1]].push(specObj[spec[1]])
			else
				specifications[spec[0]][spec[1]] = [ specObj[spec[1]] ]
		}
		else {
			specifications[spec[0]] = {}
			specifications[spec[0]][spec[1]] = [ specObj[spec[1]] ]
		}
	}

	for (var cat in specifications) {
		var catList = specifications[cat]
		var catFreq = Object.keys(catList).length

		for (var type in catList) {
			var typeList = catList[type]
			var typeFreq = Object.keys(typeList).length

			catList[type] = {freq: typeFreq, typeList: typeList, type: type}
		}

		specifications[cat] = {freq: catFreq, cat: catList}
	}

	for (var cat in specifications) {
		console.log(specifications[cat]);
		specifications[cat].cat = _.sortBy(specifications[cat].cat, function(spec) {
			return -spec.freq
		})		
	}


	// Generating DOM from specs

	window.onload = function() {
		var catsContainer = $("#category-container")
		var i = 0, k = 0
		var colContainer
		for (var cat in specifications) {
			var catList = specifications[cat].cat
			var catFreq = specifications[cat].freq

			if (catFreq < 2)
				continue
			if (i%2 === 0) {
				catsContainer.append("<div class='column-container' number="+i+"></div>")
				colContainer = catsContainer.find('[number='+i+']')
			}

			switch (k) {
				case 0:
					colContainer.append("<div class='category column banner one' category='"+cat+"' freq='"+catFreq+"'><i class='fa fa-fw fa-3x fa-"+cat+"'></i>")
					break
				case 1:
					colContainer.append("<div class='category column banner two' category='"+cat+"' freq='"+catFreq+"'><i class='fa fa-fw fa-3x fa-"+cat+"'></i>")
					break
				case 2:
					colContainer.append("<div class='category column banner three' category='"+cat+"' freq='"+catFreq+"'><i class='fa fa-fw fa-3x fa-"+cat+"'></i>")
					break
			}

			var catContainer = colContainer.find('[category='+cat+']')
			for (var type in catList) {

				var entries = catList[type].typeList
				var freq = catList[type].freq
				var title = catList[type].type

				catContainer.append("<div class='type' type='"+title+"' freq="+freq+"><h2 style='font-size:"+(freq*20)+"px'>"+title+"</h2></div>")
				var typeContainer = catContainer.find('[type="'+title+'"]')
				for (var j in entries) {
					var entry = entries[j]
					typeContainer.append('<a href="'+entry.url+'">'+entry.title+'</a><br>')
				}
			}

			i++
			k = (k+1)%3
		}
	}
})()
</script>
<div id="category-container">
</div>